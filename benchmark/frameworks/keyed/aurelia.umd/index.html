<!DOCTYPE html>
<html>

<head>
  <meta charset="utf-8">
  <title>Aurelia UMD</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link href="/css/currentStyle.css" rel="stylesheet" />
</head>

<body>
  <script src="./node_modules/aurelia-script/dist/aurelia.umd.min.js"></script>
  <app>
    <template>
      <div class="container">
        <div class="jumbotron">
          <div class="row">
            <div class="col-md-6">
              <h1>Aurelia</h1>
            </div>
            <div class="col-md-6">
              <div class="col-sm-6 smallpad">
                <button type="button" class="btn btn-primary btn-block" id="run" click.delegate="run()">Create 1,000
                  rows</button>
              </div>
              <div class="col-sm-6 smallpad">
                <button type="button" class="btn btn-primary btn-block" id="runlots" click.delegate="runLots()">Create
                  10,000 rows</button>
              </div>
              <div class="col-sm-6 smallpad">
                <button type="button" class="btn btn-primary btn-block" id="add" click.delegate="add()">Append 1,000
                  rows</button>
              </div>
              <div class="col-sm-6 smallpad">
                <button type="button" class="btn btn-primary btn-block" id="update" click.delegate="update()">Update
                  every 10th row</button>
              </div>
              <div class="col-sm-6 smallpad">
                <button type="button" class="btn btn-primary btn-block" id="clear" click.delegate="clear()">Clear</button>
              </div>
              <div class="col-sm-6 smallpad">
                <button type="button" class="btn btn-primary btn-block" id="swaprows" click.delegate="swapRows()">Swap
                  Rows</button>
              </div>
            </div>
          </div>
        </div>
        <table class="table table-hover table-striped test-data">
          <tbody>
            <tr repeat.for="item of store.data" class.bind="item.id === store.selected ? 'danger' : ''">
              <td class="col-md-1">${item.id }</td>
              <td class="col-md-4">
                <a click.delegate="select(item)">${item.label}</a>
              </td>
              <td class="col-md-1"><a click.delegate="remove(item)">
                  <span class="glyphicon glyphicon-remove" aria-hidden="true"></span></a>
              </td>
              <td class="col-md-6"></td>
            </tr>
          </tbody>
        </table>
        <span class="preloadicon glyphicon glyphicon-remove" aria-hidden="true"></span>
      </div>

    </template>
  </app>
  <script>
    var startTime;
    var lastMeasure;
    var startMeasure = function (name) {
      startTime = performance.now();
      lastMeasure = name;
    }
    var stopMeasure = function () {
      window.setTimeout(function () {
        var stop = performance.now();
        console.log(lastMeasure + " took " + (stop - startTime));
      }, 0);
    }

    function _random(max) {
      return Math.round(Math.random() * 1000) % max;
    }
    class Store {
      constructor() {
        this.data = [];
        this.selected = undefined;
        this.id = 1;
      }
      buildData(count = 1000) {
        var adjectives = ["pretty", "large", "big", "small", "tall", "short", "long", "handsome", "plain", "quaint",
          "clean", "elegant", "easy", "angry", "crazy", "helpful", "mushy", "odd", "unsightly", "adorable",
          "important", "inexpensive", "cheap", "expensive", "fancy"
        ];
        var colours = ["red", "yellow", "blue", "green", "pink", "brown", "purple", "brown", "white", "black",
          "orange"
        ];
        var nouns = ["table", "chair", "house", "bbq", "desk", "car", "pony", "cookie", "sandwich", "burger", "pizza",
          "mouse", "keyboard"
        ];
        var data = [];
        for (var i = 0; i < count; i++)
          data.push({
            id: this.id++,
            label: adjectives[_random(adjectives.length)] + " " + colours[_random(colours.length)] + " " + nouns[
              _random(nouns.length)]
          });
        return data;
      }
      updateData(mod = 10) {
        for (let i = 0; i < this.data.length; i += 10) {
          this.data[i].label += ' !!!';
        }
      }
      delete(id) {
        debugger
        const idx = this.data.findIndex(d => d.id == id);
        this.data = this.data.filter((e, i) => i != idx);
        return this;
      }
      deleteNext(id) {
        const idx = this.data.findIndex(d => d.id == id);
        this.data = this.data.filter((e, i) => i != idx + 1);
        return this;
      }
      run() {
        this.data = this.buildData();
        this.selected = undefined;
      }
      add() {
        this.data = this.data.concat(this.buildData(1000));
        this.selected = undefined;
      }
      update() {
        this.updateData();
      }
      select(id) {
        this.selected = id;
      }
      hideAll() {
        this.backup = this.data;
        this.data = [];
        this.selected = undefined;
      }
      showAll() {
        this.data = this.backup;
        this.backup = null;
        this.selected = undefined;
      }
      runLots() {
        this.data = this.buildData(10000);
        this.selected = undefined;
      }
      clear() {
        this.data = [];
        this.selected = undefined;
      }
      swapRows() {
        if (this.data.length > 998) {
          let newData = this.data.slice();
          var temp = this.data[1];
          var temp2 = this.data[998];
          newData[1] = temp2
          newData[998] = temp;
          this.data = newData;
        }
      }

    }

    class App {

      static $view() {
        return document.querySelector('app').firstElementChild
      }

      constructor() {
        this.store = new Store();
      }

      run() {
        startMeasure("run");
        this.store.run();
        stopMeasure();
      }
      add() {
        startMeasure("add");
        this.store.add();
        stopMeasure();
      }
      remove(item) {
        startMeasure("delete");
        debugger
        this.store.delete(item.id);
        stopMeasure();
      }
      select(item) {
        startMeasure("select");
        this.store.select(item.id);
        stopMeasure();
      }
      update() {
        startMeasure("update");
        this.store.update();
        stopMeasure();
      }

      runLots() {
        startMeasure("runLots");
        this.store.runLots();
        stopMeasure();
      }

      clear() {
        startMeasure("clear");
        this.store.clear();
        stopMeasure();
      }

      swapRows() {
        startMeasure("swapRows");
        this.store.swapRows();
        stopMeasure();
      }
    }


    const aurelia = new au.Aurelia();
    aurelia.use.standardConfiguration();
    aurelia
      .start().then(() => aurelia.setRoot(App, document.querySelector('app')));

  </script>
</body>

</html>
